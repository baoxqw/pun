{"remainingRequest":"D:\\workspace-suzhouzhibiao\\code\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workspace-suzhouzhibiao\\code\\indicator\\Pncui-Indicator\\src\\views\\indicators\\result\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workspace-suzhouzhibiao\\code\\indicator\\Pncui-Indicator\\src\\views\\indicators\\result\\index.vue","mtime":1645075664970},{"path":"D:\\workspace-suzhouzhibiao\\code\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\code\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\workspace-suzhouzhibiao\\code\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\code\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nfunction getDay(num) {\n  var today = new Date();\n  var nowTime = today.getTime();\n  var ms = 24*3600*1000*num;\n  today.setTime(parseInt(nowTime + ms));\n  today.setHours(23);\n  today.setMinutes(59);\n  today.setSeconds(59);\n\n /* var oYear = today.getFullYear();\n  var oMoth = (today.getMonth() + 1).toString();\n  if (oMoth.length <= 1) oMoth = '0' + oMoth;\n  var oDay = today.getDate().toString();\n  if (oDay.length <= 1) oDay = '0' + oDay;\n  let m =  oYear + '-' + oMoth + '-' + oDay + ' ' + today.getHours().toString() + ':' + today.getMinutes() + ':' + today.getSeconds();\n  console.log(\"==\" + m)*/\n  return today;\n}\n\nimport crudIndIndicatorResult, {addFavorites,removeFavorites,saveReadRec} from '../../../api/indicators/indIndicatorResult'\nimport { getResultDepts} from '@/api/indicators/indResultSubscribe'\n  import CRUD, { presenter, header, form, crud } from '@crud/crud'\n  import rrOperation from '@crud/RR.operation'\n  import crudOperation from '@crud/CRUD.operation'\n  // import udOperation from '@crud/UD.operation'\n  import pagination from '@crud/Pagination'\n  import category from '../category/category'\n  import { getDepts } from '@/utils/system'\n  import Treeselect from '@riophae/vue-treeselect'\n  import '@riophae/vue-treeselect/dist/vue-treeselect.css'\n  import moment from \"moment\";\n  // crud交由presenter持有\n  const defaultCrud = CRUD({\n    title: '指标计算结果表',\n    url: crudIndIndicatorResult.url,\n    sort: 'id,desc',\n    initQry: false,\n    crudMethod: { ...crudIndIndicatorResult.crud }\n  })\n  const defaultForm = {\n    id: null,\n    orgId: null,\n    ieId: null,\n    ieCode: null,\n    ieName: null,\n    ieValue: null,\n    status: null,\n    crtUserCode: null,\n    crtOrgCode: null,\n    crtDate: null,\n    updUserCode: null,\n    updOrgCode: null,\n    updDate: null,\n    frequency: null,\n    periodDateInterval:null,\n    ieKindOneName:null\n  }\n  export default {\n    name: 'IndIndicatorResult',\n    components: { Treeselect,pagination, crudOperation, rrOperation, category },\n    mixins: [presenter(defaultCrud), header(), form(defaultForm), crud()],\n    dicts: ['IND_FIRST_TYPE','RETENTION', 'IE_TYPE', 'IE_STATUS','IND_CURRENCY','YN','IE_FREQUENCY'],\n    data() {\n      return {\n        depts: [],\n        defaultProps: {\n          children: 'children',\n          label: 'label'\n        },\n        table: {\n          columns: {\n            id: 'hidden',\n            ieId: 'hidden',\n            updUserCode: 'hidden',\n            updDate: 'hidden'\n          }\n        },\n        permission: {\n          add: [''],\n          edit: [''],\n          del: ['']\n        },\n        showDialog: false,\n        pickerMinDate: \"\",//第一次选中的时间\n        pickerOptions: {\n          onPick: obj => {\n\n            //this.pickerMinDate = new Date(obj.minDate).getTime();\n            //console.log(\"times===>,\" + this.pickerTimes + \", pickerMinDate==>\" + this.pickerMinDate)\n            //this.pickerMaxDate = new Date(obj.maxDate).getTime();\n            //this.query.periodDateInterval= [this.pickerMinDate, this.pickerMaxDate]\n            //this.$set(this.query,'periodDateInterval',[obj.minDate, obj.maxDate]);\n          },\n          disabledDate: time => {\n            let yestoday = getDay(-1);\n            if (this.pickerMinDate) {\n              const day1 = 366 * 24 * 3600 * 1000;\n              let maxTime = this.pickerMinDate + day1;\n              let minTime = yestoday - day1;\n              return time.getTime() < minTime || time.getTime() > yestoday;\n            } else {\n              const day1 = 366 * 24 * 3600 * 1000;\n              let minTime = yestoday - day1;\n              return time.getTime() < minTime || time.getTime() > yestoday;\n            }\n          }\n        },\n        form:{},\n      }\n    },\n    created() {\n      //debugger\n      //defaultCrud.query.periodDateInterval = this.timeDefault\n      this.crud.optShow.del=false\n      this.crud.optShow.edit=false\n      this.crud.optShow.add=false\n      this.getDepts();\n      if(this.$route.query.ieName) {\n        this.query.ieName = this.$route.query.ieName\n      }\n      if(this.$route.query.deptId) {\n        this.query.deptId = this.$route.query.deptId\n      }\n      if(this.$route.query.currency) {\n        this.query.currency = this.$route.query.currency\n      }\n      if(this.$route.query.frequency) {\n        this.query.frequency = this.$route.query.frequency\n      }\n\n      if((this.$route.query.ieName == null || this.$route.query.ieName == 'undefined' || this.$route.query.ieName == '')\n          && (this.$route.query.deptId == null || this.$route.query.deptId == 'undefined'  || this.$route.query.deptId == '')\n          && (this.$route.query.currency == null || this.$route.query.currency == 'undefined' || this.$route.query.currency == '')\n          && (this.$route.query.frequency == null || this.$route.query.frequency == 'undefined' || this.$route.query.frequency == '')){\n        //this.crud.resetQuery(false);\n        this.getPassYearFormatDate ();\n        this.query.ieName = ''\n        this.query.deptId = null\n        this.query.currency = ''\n        this.query.frequency = ''\n        this.query.isFavorites =''\n        //this.query.periodDateInterval =''\n        this.query.isNotClearIeName = true\n        defaultCrud.loading = false\n      }\n      if((this.query.ieName == null || this.query.ieName == 'undefined'  || this.query.ieName == '')\n          && (this.query.deptId == null || this.query.deptId == 'undefined' || this.query.deptId == '')\n          && (this.query.currency == null || this.query.currency == 'undefined' || this.query.currency == '')\n          && (this.query.frequency == null || this.query.frequency == 'undefined' || this.query.frequency == '')){\n        console.log(\"无条件查询\")\n        //defaultCrud.initQry = false\n        //defaultCrud.refresh()\n      }else{\n        //CRUD.toQuery\n        console.log(\"有条件查询\")\n        //defaultCrud.initQry = true\n        //defaultCrud.refresh()\n      }\n    },\n    mounted() {\n      //debugger\n      if(this.$route.query.ieName == null || this.$route.query.ieName == 'undefined' || this.$route.query.ieName == '') {\n        this.getPassYearFormatDate ();\n        //this.query.periodDateInterval = this.timeDefault\n      } else {\n        this.query.periodDateInterval =[]\n      }\n    },\n    computed: {\n      // 默认时间\n      timeDefault () {\n        /!*console.log(\"times===>,\" + this.pickerTimes)*!/\n        var defalutStartTime = moment().subtract(1,\"year\").format('YYYY-MM-DD')\n        var defalutEndTime = moment().format('YYYY-MM-DD')\n        return [defalutStartTime, defalutEndTime]\n      }\n    },\n    methods: {\n      resetQuery(){\n        this.crud.resetQuery();\n        this.query.isNotClearIeName = true\n        if(this.$route.query.ieName == null || this.$route.query.ieName == 'undefined' || this.$route.query.ieName == '') {\n          this.getPassYearFormatDate ();\n          this.query.ieName= ''\n          this.query.deptId= null\n          this.query.currency= ''\n          this.query.frequency= ''\n          this.query.isFavorites= ''\n          //this.query.periodDateInterval = this.timeDefault\n        } else {\n          this.query.periodDateInterval =[]\n        }\n        this.crud.refresh()\n      },\n      changeTime(e){\n        this.$forceUpdate()\n      },\n      // 获取数据前设置好接口地址\n      [CRUD.HOOK.beforeRefresh]() {\n        //debugger\n        if(this.$route.query.ieName) {\n          this.query.ieName = this.$route.query.ieName\n          this.query.periodDateInterval =[]\n        } else if(!this.query.isNotClearIeName){\n          this.query.ieName = '';\n          if(this.query.periodDateInterval == null || this.query.periodDateInterval == 'undifined' || this.query.periodDateInterval == []) {\n            //defaultCrud.loading = false\n            //defaultCrud.initQry = true\n            return false;\n          }\n        }\n        /*if(defaultCrud.initQry){\n          defaultCrud.loading = true\n          return true\n        }else{\n          defaultCrud.initQry = true\n          defaultCrud.loading = false\n          return false\n        }*/\n        return true\n      },\n      [CRUD.HOOK.beforeToDetail](data) {\n        this.form.correspondRate = (data.form.correspondRate == null)? 0 : data.form.correspondRate\n        this.form.yearFloatRate = (data.form.yearFloatRate == null)? 0 : data.form.yearFloatRate\n        this.form.circalRate = (data.form.circalRate == null)? 0 : data.form.circalRate\n      },\n      viewHandle(row) {\n        this.form = row\n        this.form.correspondRate = (row.correspondRate == null)? 0 : row.correspondRate\n        this.form.yearFloatRate = (row.yearFloatRate == null)? 0 : row.yearFloatRate\n        this.form.circalRate = (row.circalRate == null)? 0 : row.circalRate\n        this.showDialog = true\n        this.saveReadRec(row.id)\n      },\n      getDepts() {\n        getResultDepts().then(res => {\n          this.depts = res.content\n        })\n      },\n      saveReadRec(id) {\n        saveReadRec(id).then(res => {\n          console.log(\"saveReadRec res===>,\" + res)\n        })\n      },\n      addFavorites(data) {\n        console.log(\"addFavorites,\" + data)\n        if(data == null && !Array.isArray(data)) {\n          this.$notify({\n            title: '请选择指标结果',\n            type: 'warning',\n            duration: 2500\n          })\n          return\n        }\n        let ids = \"\";\n        for(let i = 0; i < data.length; i++) {\n          ids += data[i].id + \",\";\n        }\n        if(ids != null && ids.includes(\",\")) {\n          ids = ids.substr(0,ids.length - 1);\n        }\n        addFavorites(ids).then(res => {\n          console.log(\"addFavorites res===>,\" + res)\n          if(res.code === 0) {\n            defaultCrud.notify(res.msg, CRUD.NOTIFICATION_TYPE.SUCCESS)\n          } else {\n            defaultCrud.notify(res.msg, CRUD.NOTIFICATION_TYPE.ERROR)\n          }\n          defaultCrud.refresh()\n        })\n      },\n      removeFavorites(data) {\n        console.log(\"removeFavorites,\" + data)\n        if(data == null && !Array.isArray(data)) {\n          this.$notify({\n            title: '请选择指标结果',\n            type: 'warning',\n            duration: 2500\n          })\n          return\n        }\n        let ids = \"\";\n        for(let i = 0; i < data.length; i++) {\n          ids += data[i].id + \",\";\n        }\n        if(ids != null && ids.includes(\",\")) {\n          ids = ids.substr(0,ids.length - 1);\n        }\n        removeFavorites(ids).then(res => {\n          console.log(\"removeFavorites res===>,\" + res)\n          if(res.code === 0) {\n            defaultCrud.notify(res.msg, CRUD.NOTIFICATION_TYPE.SUCCESS)\n          } else {\n            defaultCrud.notify(res.msg, CRUD.NOTIFICATION_TYPE.ERROR)\n          }\n          defaultCrud.refresh()\n        })\n      },\n      cellStyle(data) {\n        if(data.row.readed === 0) {\n          return 'font-weight: 1000;color:#1742a5;'\n        } else {\n          return ''\n        }\n      },\n      /*refreshList() {\n        this.crud.refresh()\n      },*/\n      forceUpdate() {\n        this.$forceUpdate()\n      },\n      handleCategoryClick(data) {\n        this.crud.form.categoryId = data.id\n        this.crud.query.categoryIds = data.childrenIds\n        this.crud.query.categoryType = data.categoryType\n        this.crud.query.categoryLevel = data.level\n        if (data.categoryType == '0') {\n          this.crud.query.categoryId = data.id\n        } else {\n          this.crud.query.categoryId = data.childrenIds != null ? data.childrenIds.toString() : \"\";\n        }\n\n        this.form.categoryType = data.categoryType\n        this.form.categoryId = data.id\n        this.crud.form.indFirstType = data.id;\n        this.crud.refresh()\n      },\n      /* 获取过去时间，并传值给现在时间 */\n      getPassYearFormatDate () {\n        var nowDate = getDay(-1)\n        //nowDate.setDate(nowDate.getDate() - 1)\n        var date = new Date(nowDate)\n        date.setDate(date.getDate() - 365)\n        var seperator1 = '-'\n        var year = date.getFullYear()\n        var month = date.getMonth() + 1\n        var strDate = date.getDate()\n        if (month >= 1 && month <= 9) {\n          month = '0' + month\n        }\n        if (strDate >= 0 && strDate <= 9) {\n          strDate = '0' + strDate\n        }\n        var formatDate = year + seperator1 + month + seperator1 + strDate\n        this.getNowFormatDate(formatDate)\n      },\n      /* 获取现在时间，并接受过去时间的值 */\n      getNowFormatDate (formatDate) {\n        var date = getDay(-1)\n        //date.setDate(date.getDate() - 1)\n        var seperator1 = '-'\n        var year = date.getFullYear()\n        var month = date.getMonth() + 1\n        var strDate = date.getDate()\n        if (month >= 1 && month <= 9) {\n          month = '0' + month\n        }\n        if (strDate >= 0 && strDate <= 9) {\n          strDate = '0' + strDate\n        }\n        var nowData = year + seperator1 + month + seperator1 + strDate\n        this.query.periodDateInterval= [formatDate, nowData]  // 默认赋值一年时间\n        //this.$set(this.query,\"periodDateInterval\",[formatDate, nowData]);\n      }\n    }\n  }\n",null]}